<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="MCM Blog — Firebase Authentication Implementation"
    />
    <title>MCM — Blog</title>

    <!-- Bulma & Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Navbar -->
    <header>
      <nav
        class="navbar is-dark"
        role="navigation"
        aria-label="main navigation"
      >
        <div class="navbar-brand">
          <a class="navbar-item brand-logo-link" href="Home.html">
            <img
              src="images/logo_white_gold_blue.png"
              alt="MCM Home"
              class="brand-logo"
            />
          </a>
          <a
            role="button"
            class="navbar-burger"
            aria-label="menu"
            aria-expanded="false"
            data-target="navbarBasic"
          >
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
          </a>
        </div>

        <div id="navbarBasic" class="navbar-menu">
          <div class="navbar-end" id="authArea">
            <a class="navbar-item" href="Home.html">Home</a>
            <a class="navbar-item" href="about.html">About</a>
            <a class="navbar-item active-page" href="blog.html">Blog</a>
            <a class="navbar-item" href="Contact.html">Contact</a>

            <!-- Signed-out -->
            <a class="navbar-item" href="#auth" data-auth="signed-out"
              >Sign In</a
            >
            <a class="navbar-item" href="#auth" data-auth="signed-out"
              >Sign Up</a
            >

            <!-- Signed-in -->
            <span
              class="navbar-item has-text-gold"
              data-auth="signed-in"
              style="display: none"
            >
              Welcome, <span id="navUserEmail">User</span>
            </span>
            <a
              class="navbar-item"
              href="#"
              id="signOutBtn"
              data-auth="signed-in"
              style="display: none"
              >Sign Out</a
            >
          </div>
        </div>
      </nav>
    </header>

    <main>
      <!-- Blog Header -->
      <section class="section">
        <div class="container">
          <div class="columns is-vcentered">
            <div class="column is-6">
              <h1 class="title is-2 has-text-weight-bold has-text-navy">
                Sprint 2 — Firebase Authentication
              </h1>
              <p class="subtitle is-5" style="color: var(--ink)">
                This sprint focuses on adding user authentication:
                <strong>Sign Up</strong>, <strong>Sign In</strong>, and
                <strong>Sign Out</strong>, with a personalized welcome message
                after login.
              </p>
              <a class="button cta-primary is-medium" href="#auth"
                >Try It Now</a
              >
            </div>
            <div class="column is-6">
              <figure class="image">
                <img
                  src="images/civilian_cycle.png"
                  alt="Civilian Stability Cycle"
                  loading="lazy"
                />
              </figure>
            </div>
          </div>
        </div>
      </section>

      <!-- Welcome Message (Visible when logged in) -->
      <section class="section" id="welcomeSection" style="display: none">
        <div class="container">
          <div class="box has-border-left-gold">
            <div class="columns is-vcentered">
              <div class="column is-8">
                <h2 class="title is-4 has-text-navy">
                  Welcome back,
                  <span id="welcomeUserEmail">user@example.com</span>!
                </h2>
                <p class="is-size-6" style="color: var(--ink2)">
                  You are successfully signed in. Explore the blog, check out
                  new content, or sign out securely anytime.
                </p>
                <div class="buttons mt-4">
                  <a class="button cta-primary" href="Home.html">Go to Home</a>
                  <a class="button" id="inlineSignOutBtn">Sign Out</a>
                </div>
              </div>
              <div class="column is-4">
                <figure class="image">
                  <img
                    src="images/brand_profile2.png"
                    alt="Mentor"
                    loading="lazy"
                  />
                </figure>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Auth Forms (Visible when logged out) -->
      <section class="section has-background-soft-gray" id="auth">
        <div class="container">
          <div class="columns is-variable is-6">
            <!-- Sign In -->
            <div class="column is-6" id="signInCard">
              <div class="box">
                <h3 class="title is-4 has-text-navy">Sign In</h3>
                <form id="signInForm" novalidate>
                  <div class="field">
                    <label class="label">Email</label>
                    <div class="control has-icons-left">
                      <input
                        class="input"
                        id="signInEmail"
                        type="email"
                        placeholder="you@example.com"
                        required
                      />
                      <span class="icon is-small is-left"
                        ><i class="fas fa-envelope"></i
                      ></span>
                    </div>
                  </div>
                  <div class="field">
                    <label class="label">Password</label>
                    <div class="control has-icons-left">
                      <input
                        class="input"
                        id="signInPassword"
                        type="password"
                        placeholder="••••••••"
                        minlength="6"
                        required
                      />
                      <span class="icon is-small is-left"
                        ><i class="fas fa-lock"></i
                      ></span>
                    </div>
                  </div>
                  <p
                    class="help is-danger"
                    id="signInError"
                    style="display: none"
                  ></p>
                  <div class="field mt-4">
                    <button
                      class="button cta-primary is-fullwidth"
                      type="submit"
                    >
                      Sign In
                    </button>
                  </div>
                </form>
              </div>
            </div>

            <!-- Sign Up -->
            <div class="column is-6" id="signUpCard">
              <div class="box">
                <h3 class="title is-4 has-text-navy">Sign Up</h3>
                <form id="signUpForm" novalidate>
                  <div class="field">
                    <label class="label">Email</label>
                    <div class="control has-icons-left">
                      <input
                        class="input"
                        id="signUpEmail"
                        type="email"
                        placeholder="you@example.com"
                        required
                      />
                      <span class="icon is-small is-left"
                        ><i class="fas fa-envelope"></i
                      ></span>
                    </div>
                  </div>
                  <div class="field">
                    <label class="label">Password</label>
                    <div class="control has-icons-left">
                      <input
                        class="input"
                        id="signUpPassword"
                        type="password"
                        placeholder="At least 6 characters"
                        minlength="6"
                        required
                      />
                      <span class="icon is-small is-left"
                        ><i class="fas fa-lock"></i
                      ></span>
                    </div>
                  </div>
                  <p
                    class="help is-danger"
                    id="signUpError"
                    style="display: none"
                  ></p>
                  <div class="field mt-4">
                    <button
                      class="button cta-primary is-fullwidth"
                      type="submit"
                    >
                      Create Account
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>

          <div class="content mt-2">
            <p class="is-size-7" style="color: var(--ink2)">
              Tip: Try creating two accounts and testing login, invalid
              passwords, and duplicate email handling. Error messages appear
              below each form.
            </p>
          </div>
        </div>
      </section>

      <!-- Sprint Notes -->
      <section class="section">
        <div class="container">
          <div class="box has-border-left-gold">
            <h3 class="title is-4 has-text-navy">Sprint Notes</h3>
            <ul class="content">
              <li>
                Integrated <strong>Firebase v9 modular API</strong> with
                <code>onAuthStateChanged</code> to sync user sessions across
                pages.
              </li>
              <li>
                Added form validation (email format and password length ≥ 6).
              </li>
              <li>
                Mapped Firebase error codes to user-friendly messages and
                updated UI dynamically after login/logout.
              </li>
            </ul>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer isyellow">
      <div class="content has-text-centered">
        <p>
          <strong>MCM</strong> by Team 3 IS424 &nbsp;|&nbsp; &copy; 2025. All
          rights reserved.
        </p>
      </div>
    </footer>

    <!-- Navbar toggle -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const burger = document.querySelector(".navbar-burger");
        const menu = document.getElementById("navbarBasic");
        if (burger && menu) {
          burger.addEventListener("click", () => {
            burger.classList.toggle("is-active");
            menu.classList.toggle("is-active");
          });
        }
      });
    </script>

    <!-- Firebase Authentication Logic -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
      import {
        getAuth,
        onAuthStateChanged,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

      // Replace this with your Firebase config
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        appId: "YOUR_APP_ID",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // DOM elements
      const authArea = document.getElementById("authArea");
      const navUserEmail = document.getElementById("navUserEmail");
      const signOutBtn = document.getElementById("signOutBtn");
      const inlineSignOutBtn = document.getElementById("inlineSignOutBtn");
      const welcomeSection = document.getElementById("welcomeSection");
      const welcomeUserEmail = document.getElementById("welcomeUserEmail");
      const signInForm = document.getElementById("signInForm");
      const signUpForm = document.getElementById("signUpForm");
      const signInError = document.getElementById("signInError");
      const signUpError = document.getElementById("signUpError");

      function toggleAuthUI(isSignedIn, email = "") {
        authArea
          .querySelectorAll('[data-auth="signed-in"]')
          .forEach((el) => (el.style.display = isSignedIn ? "" : "none"));
        authArea
          .querySelectorAll('[data-auth="signed-out"]')
          .forEach((el) => (el.style.display = isSignedIn ? "none" : ""));
        document.getElementById("auth").style.display = isSignedIn
          ? "none"
          : "";
        welcomeSection.style.display = isSignedIn ? "" : "none";
        if (isSignedIn) {
          navUserEmail.textContent = email;
          welcomeUserEmail.textContent = email;
        }
      }

      function showError(el, msg) {
        el.textContent = msg;
        el.style.display = msg ? "" : "none";
      }

      function mapError(code) {
        const errors = {
          "auth/invalid-email": "Invalid email address.",
          "auth/missing-password": "Please enter your password.",
          "auth/weak-password": "Password must be at least 6 characters.",
          "auth/email-already-in-use": "This email is already registered.",
          "auth/user-not-found": "No account found with this email.",
          "auth/wrong-password": "Incorrect email or password.",
        };
        return errors[code] || "Authentication error. Please try again.";
      }

      // Auth state observer
      onAuthStateChanged(auth, (user) => {
        if (user && user.email) {
          toggleAuthUI(true, user.email);
        } else {
          toggleAuthUI(false);
        }
      });

      // Sign In
      signInForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        showError(signInError, "");
        const email = document.getElementById("signInEmail").value.trim();
        const password = document.getElementById("signInPassword").value;
        try {
          await signInWithEmailAndPassword(auth, email, password);
        } catch (err) {
          showError(signInError, mapError(err.code));
        }
      });

      // Sign Up
      signUpForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        showError(signUpError, "");
        const email = document.getElementById("signUpEmail").value.trim();
        const password = document.getElementById("signUpPassword").value;
        try {
          await createUserWithEmailAndPassword(auth, email, password);
        } catch (err) {
          showError(signUpError, mapError(err.code));
        }
      });

      // Sign Out
      async function handleSignOut(e) {
        e.preventDefault();
        try {
          await signOut(auth);
        } catch {
          alert("Sign out failed. Please try again.");
        }
      }

      signOutBtn?.addEventListener("click", handleSignOut);
      inlineSignOutBtn?.addEventListener("click", handleSignOut);
    </script>
  </body>
</html>
